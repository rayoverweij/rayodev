---
import { getImage } from "astro:assets";
import "@styles/global.css";


interface Props {
	title: string;
	desc: string;
	ogImageData: ImageMetadata;
	ogImageAlt: string;
	bg?: "white" | "rock";
}

const { title, desc, ogImageData, ogImageAlt, bg } = Astro.props;

// Get the URL for this page
const { url } = Astro;

// Get a static URL for this page's OG image
const imgURL = new URL((await getImage({ src: ogImageData, format: ogImageData.format })).src, url).href;
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1" />
		<link rel="icon" href="/favicon.ico" />
		
		<meta name="description" content={desc} />
		<meta property="og:site_name" content="Rayo Verweij" />
		<meta property="og:url" content={url} />
		<meta property="og:type" content="website" />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={desc} />
		<meta property="og:locale" content="en_GB" />
		<meta property="og:image" content={imgURL} />
		<meta property="og:image:alt" content={ogImageAlt} />
		
		<title>{ title } | Rayo Verweij</title>
		
		<script>
			document.documentElement.classList.toggle("dark",
				localStorage.theme === "dark" || (!("theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)
			);
		</script>
	</head>
	<body class={`relative ${bg === "rock" ? "bg-rock-100" : "bg-white"} dark:bg-rock-950 dark:text-rock-100 overflow-x-hidden`}>
		<div class="absolute top-4 right-0 md:top-0 md:right-4 z-10 flex flex-col md:flex-row items-start gap-2 text-lg">
			<button
				class="group font-emoji py-1.5 pl-1 pr-8 md:px-1.5 md:pt-6 md:pb-1 bg-purple-500/5 border-[1.5px] border-r-0 md:border-r-[1.5px] md:border-t-0 border-purple-500 rounded-l-full md:rounded-l-none md:rounded-b-full cursor-pointer translate-x-4 hover:translate-x-0 md:translate-x-0! md:-translate-y-4 md:hover:translate-y-0 hover:border-dashed transition"
				id="themeToggleLock" title="Follow system theme"
			>
				üîÆ
			</button>
			<button
				class="group font-emoji py-1.5 pl-1 pr-8 md:px-1.5 md:pt-6 md:pb-1 bg-yellow-500/5 border-[1.5px] border-r-0 md:border-r-[1.5px] md:border-t-0 border-yellow-500 rounded-l-full md:rounded-l-none md:rounded-b-full dark:cursor-pointer dark:translate-x-4 dark:hover:translate-x-0 md:translate-x-0! md:dark:-translate-y-4 md:dark:hover:translate-y-0 transition"
				id="themeToggleLight" title="Light theme"
			>
				‚òÄÔ∏è
			</button>
			<button
				class="group font-emoji py-1.5 pl-1 pr-8 md:px-1.5 md:pt-6 md:pb-1 bg-slate-500/5 border-[1.5px] border-r-0 md:border-r-[1.5px] md:border-t-0 border-slate-500 rounded-l-full md:rounded-l-none md:rounded-b-full cursor-pointer dark:cursor-auto translate-x-4 dark:translate-x-0 hover:translate-x-0 md:translate-x-0! md:-translate-y-4 md:dark:translate-y-0 md:hover:translate-y-0 transition"
				id="themeToggleDark" title="Dark theme"
			>
				üåë
			</button>
		</div>

		<slot />

		<script>
			const toggleLock = document.getElementById("themeToggleLock") as HTMLButtonElement;
			const toggleLight = document.getElementById("themeToggleLight") as HTMLButtonElement;
			const toggleDark = document.getElementById("themeToggleDark") as HTMLButtonElement;
			
			if(!("theme" in localStorage)) toggleLock.classList.add("hidden");
			toggleLight.disabled = !document.documentElement.classList.contains("dark");
			toggleDark.disabled = document.documentElement.classList.contains("dark");
			
			toggleLock.addEventListener("click", () => {
				localStorage.removeItem("theme");
				document.documentElement.classList.toggle("dark", window.matchMedia("(prefers-color-scheme: dark)").matches);
				toggleLock?.classList.add("hidden");
				toggleLight.disabled = !document.documentElement.classList.contains("dark");
				toggleDark.disabled = document.documentElement.classList.contains("dark");
			});

			toggleLight.addEventListener("click", () => {
				localStorage.theme = "light";
				document.documentElement.classList.remove("dark");
				toggleLock.classList.remove("hidden");
				toggleLight.disabled = true;
				toggleDark.disabled = false;
			});

			toggleDark.addEventListener("click", () => {
				localStorage.theme = "dark";
				document.documentElement.classList.add("dark");
				toggleLock.classList.remove("hidden");
				toggleDark.disabled = true;
				toggleLight.disabled = false;
			});
		</script>
	</body>
</html>
